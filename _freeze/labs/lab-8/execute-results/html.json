{
  "hash": "ad25606a40a5cc639afc1eed477e0814",
  "result": {
    "markdown": "---\ntitle: \"Lab 8: Evaluating Conditions & Conducting Hypothesis Tests\"\nauthor: \"Your group's names here!\"\ndate: \"May 26, 2023\"\nformat: \n  html:\n    embed-resources: true\n    standalone: true\neditor: visual\nexecute: \n  echo: true\n  eval: false\n  message: false\n  warning: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(gapminder)\nlibrary(infer)\nlibrary(moderndive)\n```\n:::\n\n\n# Today's Data\n\nHere is a description of the `gapminder` dataset as written by two of your peers:\n\n> The gapminder dataset contains data representing three numerical attributes of a country: its average life expectancy in years, its population, and its per-capita GDP in \"international dollars\" (a hypothetical currency with the purchasing power of the U.S. dollar in 2005).\n\n> GDP data from years 1990 to 2019 come from the World Bank, which was published in May 2022. Data from previous years come from the Madison Project Database and the Penn World Table. The life expectancy data were compiled from three main sources: Mattias Lindgren and Klara Joahansson, gapminder version 7 (1800-1970), the Institute for Health Metrics and Evaluation (1970-2016), and the United Nations population data (2017-present). The geographical data for country and continent are based off of current borders as determined by the United Nations.\n\n> In total, there are 1704 observations and 6 variables, with the country variable being a factor containing 142 levels. The data were retrieved in 2008 and 2009 from [Gapminder](https://gapminder.org/), an organization that collects world data. The dataset was also manually cleaned by Dr. Jenny Bryan and her STAT 545 students.\n\n> Gapminder itself collected its GDP data from the World Bank, its life expectancy data from various studies published by the Institute for Health Metrics and Evaluation, and its population data from the US Census Bureau.\n\n## Question of Interest\n\nThe objective of this data analysis is to answer the question:\n\n> What is the relationship between life expectancy GDP per capita?\n\n# Exploratory data analysis\n\nLet's load the `gapminder` data into our workspace and start exploring!\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(gapminder)\n```\n:::\n\n\n## Data Visualization\n\n**1. Create a scatterplot of the relationship between life expectancy (response) and GDP (explanatory).**\n\n*Remember to include nice axis labels (with units!).*\n\n\n::: {.cell}\n\n:::\n\n\nWhat you see should make you concerned about using a linear regression! So, let's play with some variable transformations.\n\nYou can explore if a log-transformation of the y-variable would make the relationship more linear by adding a `scale_y_log10()` layer to your plot, like so:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlterdatasampler::hbr_maples %>% \n  ggplot(mapping = aes(x = stem_length, y = stem_dry_mass)) +\n  geom_point() + \n  scale_y_log10()\n```\n:::\n\n\nSimilarly, you can a log-transformation of the x-variable would be helpful by adding a `scale_x_log10()` layer to your plot.\n\n**2. Using `scale_x_log10()` and `scale_y_log10()`, decide on what relationship between life expectancy and GDP per capita appears the most linear.**\n\n*Remember to include nice axis labels (with units!).*\n\n\n::: {.cell}\n\n:::\n\n\n# Statistical Model\n\n**3. Use `lm()` to fit the regression model you chose in #2.**\n\n*To include a variable with a log transformation in your model, you input the `variable` as `log(variable)` inside the `lm()` function (e.g., `lm(log(stem_dry_mass) ~ stem_length, data = hbr_maples)`.*\n\n\n::: {.cell}\n\n:::\n\n\n## Assessing Model Conditions\n\nThe next step is to check the conditions of our statistical model, we do this by analyzing our residuals and how the data were collected.\n\n### Independence of Observations\n\nEach row of the `gapminder` dataset is an observation for one country for one year (from 1952 to 2007).\n\n**4. Do you believe is it reasonable to assume these observations are independent of one another?**\n\n### Normality of Residuals\n\nI've provided code to visualize the residuals from the model you fit in #3 below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbroom::augment(gapminder_lm) %>% \n  ggplot(mapping = aes(x = .resid)) +\n  geom_histogram(binwidth = 5) +\n  labs(x = \"Residual\")\n```\n:::\n\n\n**5. Based on the distribution of residuals, do you believe the condition of normality is violated? Why or why not?**\n\n### Equal Variance of Residuals\n\nI've provided code to visualize the residuals versus fitted values from the model you fit in #3 below. With this plot, we want to assess if the variability (spread) of the residuals changes based on the values of the explanatory variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbroom::augment(gapminder_lm) %>% \n  ggplot(mapping = aes(y = .resid, x = `log(gdpPercap)`)) +\n  geom_point() + \n  geom_hline(yintercept = 0, color = \"red\", linewidth = 3) +\n  labs(x = \"Log Transformed GDP Per Capita\")\n```\n:::\n\n\n**6. Based on the plot above, do you believe the condition of equal variance is violated? Why or why not?**\n\n# Inference\n\n## Stating the Hypotheses\n\nNow that you've decided which regression appears the most linear, let's perform a hypothesis test for the slope coefficient.\n\n**7. Write the hypotheses [*in words*]{.underline} for testing if there is a linear relationship between the variables you used for your model in #3.**\n\n*Keep in mind, if you log-transformed y, you are testing if there is a linear relationship between log(y) and x!*\n\n$H_0$:\n\n$H_A$:\n\n## Obtaining a p-value Using Simulation\n\nNext, we will work through creating a permutation distribution using tools from the **infer** package.\n\n**8. First, we need to find the observed slope statistic, which we will save as `obs_slope`.**\n\n*Keep in mind, if you log-transformed y, you need to use log(y) as your response variable!*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobs_slope <-  gapminder %>%\n  specify(response = ____, explanatory = ____) %>%\n  calculate(stat = \"slope\")\n```\n:::\n\n\nAfter you have calculated your observed statistic, you need to create a permutation distribution of statistics that might have occurred if the null hypothesis was true.\n\n**9. Generate 500 permuted statistics for the permutation distribution and save these statistics in an object named `null_dist`.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Code for question 7 goes here! \n\nnull_dist <- \n```\n:::\n\n\nWe can visualize this null distribution with the following code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvisualise(null_dist) \n```\n:::\n\n\n**10. Use the `shade_p_value()` function to add (`+`) a vertical red line to the plot above, demonstrating where the observed slope statistic (`obs_slope`) falls on the distribution.**\n\n<!-- Add your code to the plot above! -->\n\nNow that you have calculated the observed statistic and generated a permutation distribution, you can calculate the p-value for your hypothesis test using the function `get_p_value()` from the infer package.\n\n**11. Fill in the code below to calculate the p-value for the hypothesis test you stated in #7.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_p_value(null_dist, \n            obs_stat = ____, \n            direction = ____)\n```\n:::\n\n\n**12. Based on your p-value and an** $\\alpha = 0.1$, **what decision would you reach regarding the hypotheses you stated in #7?**\n\n## Obtaining a p-value Using Theory\n\nAs we saw in the reading this week, the output from the `get_regression_table()` function provides us with theory-based estimates of our standard error, $t$-statistic, and p-value.\n\n**Use the `get_regression_table()` function to obtain the theory-based p-value for your hypothesis test.**\n\n*Hint: You'll want to use the model you fit in #3.*\n\n\n::: {.cell}\n\n:::\n\n\n**13. How does this p-value compare to what you obtained in #11?**\n\n**14. Why do you believe these p-values were similar or different?**\n\n**15. Based on your answers to #4-6, which p-value do you believe is the most reliable? Why?**\n\n*Note: If you believe neither are reliable, say so and state why.*\n",
    "supporting": [
      "lab-8_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}