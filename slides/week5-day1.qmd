---
title: "Introduction to Multiple Linear Regression"
format: 
  revealjs:
    theme: style.scss
editor: source
---

```{r set-up}
#| include: false

library(tidyverse)
library(moderndive)
library(openintro)

my_theme <- theme_bw() + 
  theme(axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20), 
        axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 20),
        panel.border = element_blank(), 
        panel.grid.minor = element_blank()
        )
```

# Lab 3

## A Grading Reminder

<br>

:::::::: columns
:::: {.column width="47%"}
::: {style="font-size: 1.25em;"}
"Complete" = Satisfactory
:::

<br>

Your group obtained a "Success" on **every** question
::::

::: {.column width="5%"}
:::

:::: {.column width="47%"}
::: {style="font-size: 1.25em;"}
"Incomplete" = Growing
:::

<br>

Your group received a "Growing" on *at least one* question
::::
::::::::

## Common Mistakes

:::: small
::: incremental
-   **Categorical variables in R (Q2)**
    -   What data types does R use to store categorical variables? Integers? Characters? Doubles? Factors? Dates?
    -   The output of `glimpse()` can help!
-   **Comparing distributions between groups (Q9)**
    -   Were trout observed in every channel type in both sections of forest?
    -   Does every group have a unimodal distribution?
    -   How different are the centers and spread of the distributions?
-   **Comparing means to distributions (Q12)**
    -   Are the means you obtained close to the peaks of the distributions? 
    -   Why might that not be the case for some distributions? 
:::
::::

## Making a Duplicate of Your Group's Lab 3 Project

::: {.small}
1. Log in to [Posit Cloud](https://posit.cloud/)
2. Open your Weeks 2-3 Group Workspace
3. Find Lab 3
:::

![](images/find-lab.png){fig-alt="A screenshot of a group's Lab 2 project in their group workspace. There is a purple box around an icon with two boxes that has a 'plus' (+) symbol in the middle."}

::: columns
::: {.column width="40%"}
::: {.small}
4. Make a personal copy of your group's Lab 3
:::
:::

::: {.column width="5%"}
:::

::: {.column width="55%"}
![](images/make-a-copy.png){width="50%" fig-alt="A screenshot of the pop-up that appears when you click on the 'Make a copy' icon next to the Lab 2 project."}
:::
:::

::: {.small}
::: {.callout-important}
# Every member must have their own copy of the lab! No one works in the original document.
:::
:::

## Completing Revisions

Lab 3 revisions are due by Wednesday, May 7.

::: small
1.  Read comments on Canvas
2.  Copy your group's lab assignment
3.  Complete your revisions
4.  Render your revised Lab 3
5.  Download your revised HTML
6.  Submit your revisions to the [original Lab 3]{.underline} assignment
:::

:::: callout-warning
# Reflections

::: small
Revisions are required to be accompanied with reflections on what you learned
while completing your revisions. These are expected to be written in your Lab 3
Quarto file (next to the problems you revised). 
:::
::::

# Midterm Project Week

## Plan for Today

1.  Review different types of multiple linear regression models

2.  Complete an activity on sample selection

3.  Start Midterm Project write-up

## Plan for Wednesday

**No lab** -- focus on getting **all** the coding accomplished for the Midterm Project

## Draft Due by Sunday

To get everyone feedback on their drafts in a timely manner, the first drafts are due by Sunday.

::: callout-caution
# Deadline Extension

A deadline extension [**is**]{.underline} permitted for the first draft. 
Deadline extensions [**are not**]{.underline} permitted for the final version
(due next week).
:::

## Deadlines Throughout the Week

To try and keep everyone on track for getting the Midterm Project draft 
completed by Sunday, I've made some "check point" assignments throughout the 
week. 

- Introduction (due Tuesday)
- Methods & Results (due Thursday)
- Discussion & Conclusion (due Sunday)

# Multiple Linear Regression

##  Before...

```{r old-slr}
#| echo: false
ncbirths %>% 
  ggplot(mapping = aes(x = weeks, y = weight)) + 
  geom_jitter(alpha = 0.5) + 
  geom_smooth(method = "lm") +
  labs(x = "Weeks of Gestation", 
       y = "Weight of Baby (lbs)") +
  my_theme

```

##  Now...

```{r two-mlr}
#| echo: false

ncbirths |> 
  drop_na(weeks, weight) |> 
  ggplot(mapping = aes(x = weeks, y = weight, color = habit)) + 
  geom_jitter(alpha = 0.5) + 
  geom_smooth(method = "lm") +
  labs(x = "Weeks of Gestation", 
       y = "Weight of Baby (lbs)", 
       color = "Birth Parent \nSmoking Status") + 
  my_theme

```

##  {background-color="#E4E4E4"}

</br> </br>

<center>

::: {style="font-size: 6em; color: #000000;"}
How?
:::

</center>

## Offsets!

```{r smoke-mlr}
#| eval: false
#| echo: true
#| code-line-numbers: false

smoke_lm <- lm(weight ~ weeks * habit, data = ncbirths)

get_regression_table(smoke_lm)

```

```{r smoke-mlr-output}
#| echo: false
smoke_lm <- lm(weight ~ weeks * habit, data = ncbirths)

get_regression_table(smoke_lm) %>% 
  select(term:std_error)
```

::: callout-note
# Interaction Model

The \* means the variables are interacting!
:::

## Estimated Regression Equations

```{r}
#| echo: false

get_regression_table(smoke_lm) %>% 
  select(term:std_error)
```

::: {style="font-size: 1.1em; color: #0F4C81;"}
What is the regression equation for non-smoker mothers?
:::

. . .

::: {style="font-size: 1.1em; color: #0F4C81;"}
What is the regression equation for smoker mothers?
:::

##  {background-color="#D4D4D4"}

::: {style="font-size: 2em; color: #000000;"}
Would you say that these two groups have different regression lines?
:::

. . .

::: {style="font-size: 2em; color: #000000;"}
What would the principle of parsimony say?
:::



##  When investigating if a relationship differs...

::: {style="font-size: 1.25em; color: #000000;"}
Always start with the "interaction" / different slopes model.
:::

. . .

::: {style="font-size: 1.25em; color: #b76352;"}
If the slopes look different, you're done!
:::

. . .

::: {style="font-size: 1.25em; color: #0F4C81;"}
If the slopes look similar, then fit the "additive" (parallel slopes) model.
:::

## 

::: {style="font-size: 2em; color: #000000;"}
Different Enough?
:::

```{r}
#| echo: false

ggplot(data = MA_schools, 
       mapping = aes(y = average_sat_math, 
                       x = perc_disadvan, 
                       color = size)) + 
  geom_point() +
  geom_smooth(method = "lm") + 
  labs(x = "Percent Economically Disadvantaged", 
       y = "Average SAT Math", 
       color = "Size of School") +
  my_theme
```

##  What if they're not very different?

```{r}
#| fig-align: center

MA_schools %>% 
  ggplot(mapping = aes(y = average_sat_math, 
                       x = perc_disadvan, 
                       color = size)) + 
  geom_point() +
  geom_parallel_slopes() + 
  labs(x = "Percent Economically Disadvantaged", 
       y = "Average SAT Math", 
       color = "Size of School") +
  my_theme
```

## Parallel Slopes

```{r}
#| eval: false
#| echo: true
#| code-line-numbers: false

lm(average_sat_math ~ perc_disadvan + size, 
   data = MA_schools)
```

</br>

```{r}
lm(average_sat_math ~ perc_disadvan + size, 
   data = MA_schools) %>% 
  get_regression_table() %>% 
  select(term:std_error)
```

. . .

::: {.callout-warning}
# What group is the baseline group?
:::

##  Group equations -- Baseline

```{r}
lm(average_sat_math ~ perc_disadvan + size, data = MA_schools) %>% 
  get_regression_table() %>% 
  select(term:std_error)
```

. . .

$$\widehat{SAT}_{small} = 588 - 2.78 \times \text{percent disadvantaged}$$

##  Group equations -- Offsets

```{r}
lm(average_sat_math ~ perc_disadvan + size, data = MA_schools) %>% 
  get_regression_table() %>% 
  select(term:std_error)
```

. . .

::: small
$$\widehat{SAT}_{medium} = (588 - 11.9) - 2.78 \times \text{percent disadvan}$$
:::

::: small
$$\widehat{SAT}_{medium} = 576.1 - 2.78 \times \text{percent disadvan}$$
:::

. . .

::: small
$$\widehat{SAT}_{large} = (588 - 6.36) - 2.78 \times \text{percent disadvan}$$
:::

::: small
$$\widehat{SAT}_{large} = 581.64 - 2.78 \times \text{percent disadvan}$$
:::

# Sample Selection Activity

## Find Your Data Group!

Once you have found other students working on the same dataset, complete [the sample selection activity](https://atheobold.github.io/stat-313-website/activity/week-5-sample-selection.html).

. . .

::: small
1.  What are the observations / rows in this dataset?

2.  From what population was the sample drawn?

3.  For an observation to be included in the dataset, what inclusion criteria needed to be met?

4.  How were the observations who satisfied the inclusion criteria sampled from the population?

5.  Based on the inclusion criteria and sampling methods, to what population can the findings of the study be generalized?
:::

# Midterm Project Work Time

## Steps Before Wednesday

::: {.midi}
::: {.incremental}
1.  Create a personal copy of the Midterm Project template on Posit Cloud. 

2. Insert the description of your dataset (from the Midterm Proposal) into the
"Introduction" section of your project. 

3.  Insert the description of the variables (from the Midterm Proposal) into the
"Methods" section of your project.

4.  Pose a research question about your selected variables, **which can be addressed with multiple linear regression**.

5.  Insert the code to create the required two visualizations.

6.  Write a description of what you see in the visualizations.

7.  Make a decision which model you believe is "best."
:::
:::
