---
title: "Week 3 Day 2"
subtitle: "STAT 313"
format: 
  revealjs:
    theme: [simple, style.scss]
editor: source
bibliography: references.bib
---

```{r}
#| include: false
#| label: set-up

library(lterdatasampler)
library(tidyverse)
library(ggridges)
library(palmerpenguins)
library(gt)

vertebrates_full_code <- and_vertebrates %>% 
  mutate(section = if_else(section == "CC", 
                           "Clear cut",
                           "Old growth"
                           )
         ) 

trout <- vertebrates_full_code %>% 
  filter(species == "Cutthroat trout")

salamander <- vertebrates_full_code %>% 
  filter(species != "Cutthroat trout")

my_theme <- theme(axis.title.x = element_text(size = 16),
                  axis.title.y = element_text(size = 16),
                  axis.title = element_text(size = 18), 
                  axis.text.x = element_text(size = 14), 
                  axis.text.y = element_text(size = 14), 
                  legend.text = element_text(size = 14), 
                  legend.title = element_text(size = 16)
                  )
```

# Lab 1 Revisions Due Friday

# Ethical Considerations with Categorical Variables

## Choosing What to Measure - Gender

Keller et al. [-@keller2017] designed a study to examine whether a
community-based suicide prevention project could increase willingness to seek
professional help for suicidal ideation among eastern Montana youth.

. . .

</br>

Students attending the *Let's Talk* theater workshop, were asked to report their
gender, race, and age.

## Choosing What to Measure - Gender

Researchers provided students with the following question:

> What is your gender?
>
> Male, Female, Other

. . .

</br>

::: {style="font-size: 1.25em; color: #ed8402;"}
What information are the researchers missing?
:::

. . .

::: {style="font-size: 1.25em; color: #ed8402"}
Why is that information important?
:::

## Choosing What to Measure - Sex

$\beta$ blockers have been shown to improve survival in patients with congestive
heart failure. These medicines block the effects of the hormone epinephrine
(adrenaline). Research suggests that beta blockers have a differing effect for
individuals with high levels of estrogen [@khan2000].

## Choosing What to Measure - Sex

The intake form for a local heart clinic asks the following question:

> What is sex were you assigned at birth?
>
> Male, Female, Other

. . .

</br>

::: {style="font-size: 1.25em; color: #ed8402;"}
What information are the doctors missing?
:::

. . .

::: {style="font-size: 1.25em; color: #ed8402"}
Why is that information important?
:::

## Choosing What to Measure - Race

Every year, the US publishes a large dataset on the public birth records for
babies born that year. These data contain information about the baby, the
pregnancy, and the birth parent(s).

## Choosing What to Measure - Race

Looking at the [`births14`](https://www.openintro.org/data/index.php?data=births14)
dataset, the race of the mother was classified as:

-   white
-   nonwhite

. . .

</br>

::: {style="font-size: 1.25em; color: #ed8402;"}
What information is missing?
:::

. . .

::: {style="font-size: 1.25em; color: #ed8402"}
Why is that information important?
:::


# Lab 3

## Today's Data

::: columns
::: {.column width="40%"}
::: small
> The `and_vertebrates` dataset contains length and weight observations for
> Coastal Cutthroat Trout and two salamander species (Coastal Giant Salamander,
> and Cascade Torrent Salamander) in previously clear cut (c. 1963) and old
> growth coniferous forest sections of Mack Creek in HJ Andrews Experimental
> Forest, Willamette National Forest, Oregon.
:::
:::

::: {.column width="5%"}
:::

::: {.column width="55%"}
![](images/hj-andrews-map.png){fig-alt="A map displaying the location of the HJ Andrews Experimental Forest in Oregon. The forest is closest to Eugene, Oregon."}
:::
:::

<!-- Tribes native to this area: Klamath, Northern Paiute, Molalla -->

## Research Question

</br>

::: centered
> Are there differences in fish biomass between clear cut and old growth sections of the HJ Andrews Forest?
:::

. . .

</br> 

::: {.callout-note}
# Clear Cutting

In the 1950s and 60s researchers clear cut sections of the HJ Andrews forest
to research the efficiency of forest operations, including logging, road
building, and forest regeneration. 
:::

<!-- Studies have shown that the impacts of clear-cutting, including changes in  -->
<!-- streamflow and nutrient losses, can persist for decades -->

## Data Layout

::: {.small}
```{r}
#| label: data-preview
#| echo: false

and_vertebrates %>% 
  group_by(species) %>% 
  slice_sample(n = 2) %>% 
  ungroup() %>% 
  gt() |> 
  tab_style(
    style = cell_text(size = "14px"),
    locations = cells_body()
  )
```
:::

. . .

What are the observations / rows in this dataset?

## If you wanted to find the mean mass for Cutthroat trout in each section, what would you do? {background-color="#b4d4ec"}

## Step 1: Remove Salamanders

</br> </br>

```{r}
#| echo: true
#| code-line-numbers: false
#| eval: false

trout <- filter(and_vertebrates, 
                species == "Cutthroat trout") 
```

## Step 2: `group_by()` + `summarize()`

```{r}
#| label: fish-mean-mass
#| code-line-numbers: false
#| echo: true
#| output-location: fragment

trout %>% 
  group_by(section) %>% 
  summarize(
    mean_mass = mean(weight_g,
                     na.rm = TRUE)
            )
```

. . .

::::::: columns
::: {.column width="20%"}
:::

::: {.column width="5%"}
:::

:::: {.column width="75%"}
::: small
**Remember `na.rm = TRUE` is important if there are missing values!**
:::
::::
:::::::

## Are they different?

::: large
```{r}
#| label: fish-mean-mass-table

trout %>% 
  group_by(section) %>% 
  summarize(mean_mass = mean(weight_g, 
                             na.rm = TRUE)
            ) %>% 
  rename(`Forest Section` = section, 
         `Mean Biomass` = mean_mass) %>% 
  gt() %>%
  tab_style(
    style = cell_text(size = "28px"),
    locations = cells_body()
  ) |> 
  tab_style(
    style = cell_text(size = "36px"), 
    locations = cells_column_labels()
  )
```
:::

Would you conclude there is a difference in fish biomass between clear cut and old growth sections of the HJ Andrews Forest?

## Let's Make a Visualization!

```{r}
#| label: section-ridge-plots
#| echo: true
#| code-line-numbers: false
#| message: false
#| warning: false
#| out-width: 60%
#| fig-align: center

ggplot(data = trout, 
       mapping = aes(x = weight_g, 
                     y = section)
       ) +
  geom_density_ridges() +
  labs(x = "Weight of Cutthroat Trout (g)",
       y = "",
       title = "Length of Salamanders for Different Sections of HJ Andrews Experimental Forest") 
```

## Are they different?

```{r}
#| label: trout-plot-inference
#| echo: false

ggplot(data = trout, 
       mapping = aes(x = weight_g, 
                     y = section)) +
  geom_density_ridges() +
  labs(x = "Weight of Cutthroat Trout (g)",
       y = "",
       title = "Length of Salamanders for Different Sections of HJ Andrews Experimental Forest") +
  my_theme
```

Would you conclude there is a difference in fish biomass between clear cut and old growth sections of the HJ Andrews Forest?

## Let's Add in the Type of Channel

::: {style="font-size: 0.75em;"}
The channels (`unittype`) of the Mack Creek which were sampled were classified into the following groups:
:::

:::::: columns
::: {.column width="15%"}
`"C"`

`"I"`

`"IP"`

`"P"`

`"R"`

`"S"`

`"SC"`

`NA`
:::

::: {.column width="5%"}
:::

::: {.column width="80%"}
cascade

riffle

isolated pool

pool

rapid

step (small falls)

side channel

not sampled by unit
:::
::::::

## If you wanted to find the mean mass for Cutthroat trout for each *type of channel* in each *section*, what would you do? {background-color="#B6CADA"}

## `group_by()` Multiple Variables

```{r}
#| label: section-channel-mass
#| code-line-numbers: false
#| echo: true
#| output-location: fragment

trout %>% 
  group_by(section, unittype) %>% 
  summarize(
    mean_mass = mean(weight_g, 
                     na.rm = TRUE)
            )
```

## Visualization 2.0 -- Incorporating Color

```{r}
#| label: ridge-plots-with-color
#| echo: true
#| code-line-numbers: false
#| message: false
#| warning: false
#| output-location: slide
#| fig-align: center

ggplot(data = trout, 
       mapping = aes(x = weight_g, 
                     fill = section, 
                     y = unittype)
       ) +
  geom_density_ridges(alpha = 0.5) +
  labs(x = "Weight of Cutthroat Trout (g)", 
       fill = "Section of HJ Andrews \nExperimental Forest", 
       y = "Type of Channel")
```


## Visualization 2.0 -- Incorporating Color

```{r}
#| echo: false
#| fig-align: center

ggplot(data = trout, 
       mapping = aes(x = weight_g, 
                     fill = section, 
                     y = unittype)
       ) +
  geom_density_ridges(alpha = 0.5) +
  labs(x = "Weight of Cutthroat Trout (g)", 
       fill = "Section of HJ Andrews \nExperimental Forest", 
       y = "Type of Channel")
```

</br>

Why put `unittype` on the y-axis instead of `section`???

## Visualization 2.0 -- Incorporating Facets

```{r}
#| label: ridge-plots-with-facets
#| echo: true
#| code-line-numbers: false
#| message: false
#| warning: false
#| output-location: slide
#| fig-align: center

ggplot(data = trout, 
       mapping = aes(x = weight_g, 
                     y = unittype)) +
  geom_density_ridges() +
  labs(x = "Weight of Cutthroat Trout (g)", 
       y = "Section of HJ Andrews Experimental Forest") +
  facet_wrap(~section)
```

## References
